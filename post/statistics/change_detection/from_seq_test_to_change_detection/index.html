<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Jaehyeok Shin">

  
  
  
    
  
  <meta name="description" content="If we know when a potential change might possibly happen in a stochastic process then we can set a sequential test to continuously monitor whether we can tell the change">

  
  <link rel="alternate" hreflang="en-us" href="https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/">

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144639945-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-144639945-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_huc50b28ae5ce84fcc767e7691e9c0c0ae_20181_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_huc50b28ae5ce84fcc767e7691e9c0c0ae_20181_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/">

  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@Project20s">
  <meta property="twitter:creator" content="@Project20s">
  
  <meta property="og:site_name" content="Jae&#39;s Blog">
  <meta property="og:url" content="https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/">
  <meta property="og:title" content="From Sequential Tests to Change Detections | Jae&#39;s Blog">
  <meta property="og:description" content="If we know when a potential change might possibly happen in a stochastic process then we can set a sequential test to continuously monitor whether we can tell the change"><meta property="og:image" content="https://shinjaehyeok.github.io/images/icon_huc50b28ae5ce84fcc767e7691e9c0c0ae_20181_512x512_fill_lanczos_center_3.png">
  <meta property="twitter:image" content="https://shinjaehyeok.github.io/images/icon_huc50b28ae5ce84fcc767e7691e9c0c0ae_20181_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2022-10-22T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2022-10-22T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/"
  },
  "headline": "From Sequential Tests to Change Detections",
  
  "datePublished": "2022-10-22T00:00:00Z",
  "dateModified": "2022-10-22T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Jaehyeok Shin"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Jae's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://shinjaehyeok.github.io/images/icon_huc50b28ae5ce84fcc767e7691e9c0c0ae_20181_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "If we know when a potential change might possibly happen in a stochastic process then we can set a sequential test to continuously monitor whether we can tell the change"
}
</script>

  

  


  


  





  <title>From Sequential Tests to Change Detections | Jae&#39;s Blog</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  
  
  
    <script>window.staDarkLightChooser = true;</script>
  
  
    <script>const isSiteThemeDark = false;</script>
  
  
  <script src="/js/load-theme.js"></script>

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Jae&#39;s Blog</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Jae&#39;s Blog</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>



  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>From Sequential Tests to Change Detections</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Oct 22, 2022
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    5 min read
  </span>
  

  
  
  
  <span class="middot-divider"></span>
  <a href="/post/statistics/change_detection/from_seq_test_to_change_detection/#disqus_thread"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/statistics/">Statistics</a></span>
  

</div>

    














  
</div>





  <div class="article-container">

    <div class="article-style">
      


<p>If we know when a potential change might possibly happen in a stochastic process then we can set a sequential test to continuously monitor whether we can tell the change is significant or not. For example, let’s imagine we have been playing a series of coin tosses so far. One day, a player brings a new coin. In this case, we know that “today” is the time when a potential change might possibly happen in the fairness of the coin we play. Hence, we can track coin tosses from “today” and tell whether we are still playing with a fair coin or not.</p>
<p>However, what if a player replaced the coin without informing others? The new coin might be still a fair one. But it could be also biased toward head or tail. How can we “detect” a potential change of the underlying stochastic process on the fly without knowing the exact time of the change?</p>
<div id="online-change-detection-problem" class="section level2">
<h2>Online change detection problem</h2>
<p>The previous example illustrates a sub field of the statistical analysis called “<a href="https://en.wikipedia.org/wiki/Change_detection">online change detection problem</a>”. Formally, suppose we have a stream of independent random observations <span class="math inline">\(X_1, X_2, \dots\)</span>. We know that under the normal condition, each observation follows a “pre-change” distribution <span class="math inline">\(P\)</span>. But if a change happens at an unknown time <span class="math inline">\(\nu \geq 0\)</span> then after the time <span class="math inline">\(\nu\)</span>, each observation in the following sub-sequence <span class="math inline">\(X_{\nu+1}, X_{\nu+2}, \dots\)</span> follows another “post-change” distribution <span class="math inline">\(Q\)</span>. Here <span class="math inline">\(\nu = 0\)</span> implies the change happened at the very beginning so all observations follow the post-change distribution <span class="math inline">\(Q\)</span>. On the other hand, we set <span class="math inline">\(\nu = \infty\)</span> to indicate a change never happens and all observations follow the pre-change distribution <span class="math inline">\(P\)</span>. The coin toss example above can be modeled by <span class="math inline">\(P = B(0.5)\)</span> and <span class="math inline">\(Q = B(p)\)</span> for some <span class="math inline">\(p \neq 0.5\)</span>. For a simple presentation, in this post we assume both pre- and post-change distributions <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span> are known to us in advance. <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Throughout this post, we refer <span class="math inline">\(\mathbb{E}_{\nu}\)</span> to the expectation operator corresponding to the case where the change happened at time <span class="math inline">\(\nu \in \{0,1,\dots,\infty\}\)</span>.</p>
<p>The standard approach of the online change detection problem is to design a stopping time <span class="math inline">\(N\)</span>. If <span class="math inline">\(N &lt; \infty\)</span> then at the time <span class="math inline">\(N\)</span>, we declare a change happened before <span class="math inline">\(N\)</span>. One commonly used metric of the efficiency of the stopping time <span class="math inline">\(N\)</span> is the worst average detection delay (WAD) conditioned on the detection time being later than the true change point that is defined by
<span class="math display">\[
\mathcal{J}(N) := \sup_{v\geq 0}\mathbb{E}_\nu \left[N - \nu | N &gt; \nu\right].
\]</span></p>
<p>Note that the WAD is lower bounded by <span class="math inline">\(1\)</span> and this lower bound can be easily achieved by setting <span class="math inline">\(N = 1\)</span>. That is, we just declare there was a change as soon as observing a single data point. If there was no change point then we can declare the change after observing another data point and so on.</p>
<p>Of course, this type of trivial change detector is far from ideal as it will trigger lots of false alerts at the highest possible frequency. In other words, this trivial change detector has the shortest run length, 1, until triggering a false alert. Therefore, when we design a change detector <span class="math inline">\(N\)</span>, we want the stopping time <span class="math inline">\(N\)</span> to be able to detect the change as quickly as possible while controlling the false alert rate at a pre-defined rate. A commonly used metric for false alert rate is called the average run length (ARL) defined by the expectation of the stopping time of the change detector under the pre-change distribution. Formally, for a fixed constant <span class="math inline">\(\alpha \in (0,1)\)</span>, we call a stopping time <span class="math inline">\(N\)</span> contols the ARL by <span class="math inline">\(1/\alpha\)</span> if
<span class="math display">\[
\mathbb{E}_{\infty}[N] \geq 1/\alpha.
\]</span></p>
</div>
<div id="building-a-change-detector-based-on-repeated-sequential-tests" class="section level2">
<h2>Building a change detector based on repeated sequential tests</h2>
<p>So far, we have discussed how one can formulate the online change detection problem: Find a stopping time <span class="math inline">\(N\)</span> minimizing the worst average detection delay (WAD), <span class="math inline">\(\mathcal{J}(N)\)</span> while controlling average run length (ARL) by <span class="math inline">\(1/\alpha\)</span>, that is, <span class="math inline">\(\mathbb{E}_{0}[N] \geq 1/\alpha.\)</span> But, how we can construct a such stopping time <span class="math inline">\(N\)</span>? The <a href="https://www.jstor.org/stable/2240115">Lorden’s lemma</a> provides a simple way to convert any sequential testing method into an online change detector by proving a fact that repeated sequential tests can be viewed as an online change detection procedure.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="lemma">
<p><span id="lem:unnamed-chunk-1" class="lemma"><strong>Lemma 1  (Lorden, G. 1971) </strong></span>Let <span class="math inline">\(N\)</span> be a stopping time of a sequential test controlling type-1 error by <span class="math inline">\(\alpha\)</span> under the pre-change distribution for a fixed <span class="math inline">\(\alpha \in (0,1)\)</span>. That is, <span class="math inline">\(\mathbb{P}_{\infty}\left(N &lt; \infty\right) \leq \alpha\)</span>. Now, let <span class="math inline">\(N_k\)</span> denote the stopping time obtained by applying <span class="math inline">\(N\)</span> to <span class="math inline">\(X_{k}, X_{k+1}, \dots\)</span>, and define another stopping time <span class="math inline">\(N^*\)</span> such that
<span class="math display">\[
  N^* := \min_{k \geq 1} \left\{N_k + k - 1\right\}.
\]</span> Then <span class="math inline">\(N^*\)</span> is a change detector controlling ARL by <span class="math inline">\(1/\alpha\)</span>, that is,
<span class="math display">\[ 
  \mathbb{E}_{\infty}\left[N^*\right] \geq 1/\alpha.\]</span>
Furthermore, the WAD of <span class="math inline">\(N^*\)</span> is upper bouned as
<span class="math display">\[
  \mathcal{J}(N) := \sup_{v\geq 0}\mathbb{E}_\nu \left[N - \nu | N &gt; \nu\right] \leq \mathbb{E}_{0}N. 
\]</span></p>
</div>
<p>As a concrete example, let’s go back to the coin toss example. If we want to test whether a coin is fair (<span class="math inline">\(P = B(p),~~p =0.5\)</span>) or biased toward the head (<span class="math inline">\(Q = B(q),~~q &gt;0.5\)</span>) with a level <span class="math inline">\(\alpha \in (0,1)\)</span> then we can use the Wald’s SPRT, which is given by the following stopping time,
<span class="math display">\[
N := \inf\left\{n \geq 1: \sum_{i=1}^n \log\Lambda_i \geq \log(1/\alpha)\right\},
\]</span>
where each <span class="math inline">\(\Lambda_n\)</span> is the likelihood ratio of <span class="math inline">\(P\)</span> over <span class="math inline">\(Q\)</span>, which is given by
<span class="math display">\[
\Lambda_n := \left(\frac{q}{p}\right)^{X_n}\left(\frac{1-q}{1-p}\right)^{1-X_n},
\]</span>
for a sequence of Bernoulli observations <span class="math inline">\(X_1, X_2, \dots \in \{0,1\}\)</span>.</p>
<p>If the stopping time happen (<span class="math inline">\(N &lt; \infty\)</span>) then we stop and reject the null hypothesis, so we conclude the coin is biased toward the head. This sequential test controls the type-1 error by <span class="math inline">\(\alpha\)</span> as we have <span class="math inline">\(P(N &lt; \infty) \leq \alpha\)</span>.</p>
<p>Now, by using the Lorden’s lemma, we can convert this sequential test into a change detection procedure <span class="math inline">\(N^*\)</span>, which is given by
<span class="math display">\[\begin{align*}
 N^* &amp;:= \min_{k \geq 1} \left\{N_k + k - 1\right\} \\
 &amp; =  \inf\left\{n \geq 1: \max_{k \geq 1}\sum_{i=k}^n \log\Lambda_i \geq \log(1/\alpha)\right\}.
\end{align*}\]</span>
If the stopping time <span class="math inline">\(N^*\)</span> happen (<span class="math inline">\(N^* &lt; \infty\)</span>) then we stop and declare that we detect a change. Note that this change detection procedure is nothing but repeated Wald’s SPRT at each time <span class="math inline">\(k\)</span>. From the Lorden’s lemma, this online change detection procedure controls the ARL by <span class="math inline">\(1/\alpha\)</span>, that is, we have <span class="math inline">\(\mathbb{E}_{\infty}[N^*] \geq 1/\alpha\)</span>. In general, we cannot get the exact ARL control <span class="math inline">\(\mathbb{E}_{\infty}[N^*] = 1/\alpha\)</span> by using the Lorden’s lemma. However, this method often performs almost as good as the optimal one. Especially for this Bernoulli case, if we replace the threshold <span class="math inline">\(\log(1/\alpha)\)</span> with another constant <span class="math inline">\(a\)</span> achieveing the exact ARL control then this procedure recovers the CUSUM procedrue which is known to be optimal procedure in this example.</p>
</div>
<div id="implementation" class="section level2">
<h2>Implementation</h2>
<p>The change detection procedure <span class="math inline">\(N^*\)</span> can be implemented in an online fashion as follows:</p>
<ul>
<li><p>Set <span class="math inline">\(M_0 := 0\)</span></p></li>
<li><p>Update <span class="math inline">\(M_n := \max\{M_{n-1}, 0\} + \log \Lambda_n\)</span></p></li>
<li><p>Make one of two following decisions:</p>
<ul>
<li>If <span class="math inline">\(M_n \geq \log(1/\alpha)\)</span> then stop and declare a change happened.</li>
<li>Otherwise, continue to the next iteration.</li>
</ul></li>
</ul>
<div id="case-1.-no-change-happens-nu-infty" class="section level3">
<h3>Case 1. No change happens (<span class="math inline">\(\nu = \infty\)</span>)</h3>
<pre class="r"><code>set.seed(1)
n_max &lt;- 500L
# This memory is not required but only for the simple visualization.
m_vec &lt;- numeric(n_max)
m &lt;- 0
# Unbiased coin toss example
p_true &lt;- 0.5
# Set up the baseline likelihood ratio
# Pre-change: p = 0.5
# Post-change: q = 0.6 
p &lt;- 0.5
q &lt;- 0.6
# ARL control at 1000
alpha &lt;- 1e-3 
n_star &lt;- Inf
not_yet_detected &lt;- TRUE
for (i in 1:n_max) {
  # Observe a new coin toss
  x &lt;- rbinom(1, 1, prob = p_true)
  # Update the change statistic
  m &lt;- max(m, 0) + ifelse(x == 1, log(q/p), log((1-q)/(1-p)))
  # Check whether the stopping time happens
  if (m &gt; log(1/alpha) &amp; not_yet_detected) {
    n_star &lt;- i
    not_yet_detected &lt;- FALSE
    # For the normal implementation, we can stop at the stopping time
    # break
  }
  # Save the statistic for visualization
  m_vec[i] &lt;- m
}
plot(1:n_max, m_vec, type = &quot;l&quot;, xlab = &quot;n&quot;, ylab = expression(&#39;M&#39;[&#39;n&#39;]),
     ylim = c(0, 20))
abline(h = log(1/alpha), col = 2)</code></pre>
<p><img src="/post/statistics/change_detection/1.from_sequential_test_to_change_detection_files/figure-html/binomial_cusum_eg1-1.png" width="672" /></p>
<pre class="r"><code>if (!is.infinite(n_star)) {
  abline(v = n_star, col = 2)
  print(paste0(&quot;Change detected at &quot;, n_star))
} else {
  print(&quot;No change detected&quot;)
}</code></pre>
<pre><code>## [1] &quot;No change detected&quot;</code></pre>
<p>In the first example, we keep using the fair coin and there is no change point (<span class="math inline">\(\nu = \infty\)</span>).
In this case, the change detection statistic <span class="math inline">\(M_n\)</span> stays below the detection line <span class="math inline">\(y = \log(1/\alpha)\)</span>, and thus we are correctly not detecting a change (<span class="math inline">\(N^* = \infty\)</span>).</p>
</div>
<div id="case-2.-change-happens-at-nu-200" class="section level3">
<h3>Case 2. Change happens at <span class="math inline">\(\nu = 200\)</span></h3>
<pre class="r"><code>set.seed(1)
n_max &lt;- 500L
# This memory is not required but only for the simple visualization.
m_vec &lt;- numeric(n_max)
m &lt;- 0
# Biased coin toss example
p_pre &lt;- 0.5
p_post &lt;- 0.6
nu &lt;- 200
# Set up the baseline likelihood ratio
# Pre-change: p = 0.5
# Post-change: q = 0.6 
p &lt;- 0.5
q &lt;- 0.6
# ARL control at 1000
alpha &lt;- 1e-3 
n_star &lt;- Inf
not_yet_detected &lt;- TRUE
for (i in 1:n_max) {
  # Observe a new coin toss
  if (i &lt; nu) {
    x &lt;- rbinom(1, 1, prob = p_pre)
  } else {
    x &lt;- rbinom(1, 1, prob = p_post)
  }
  # Update the change statistic
  m &lt;- max(m, 0) + ifelse(x == 1, log(q/p), log((1-q)/(1-p)))
  # Check whether the stopping time happens
  if (m &gt; log(1/alpha) &amp; not_yet_detected) {
    n_star &lt;- i
    not_yet_detected &lt;- FALSE
    # For the normal implemenation, we can stop at the stopping time
    # break
  }
  # Save the statistic for visualization
  m_vec[i] &lt;- m
}
plot(1:n_max, m_vec, type = &quot;l&quot;, xlab = &quot;n&quot;, ylab = expression(&#39;M&#39;[&#39;n&#39;]),
     ylim = c(0, 20))
abline(h = log(1/alpha), col = 2)
abline(v = nu, col = 1)
if (!is.infinite(n_star)) {
  abline(v = n_star, col = 2)
  print(paste0(&quot;Change detected at &quot;, n_star))
} else {
  print(&quot;No change detected&quot;)
}</code></pre>
<p><img src="/post/statistics/change_detection/1.from_sequential_test_to_change_detection_files/figure-html/binomial_cusum_eg2-1.png" width="672" /></p>
<pre><code>## [1] &quot;Change detected at 288&quot;</code></pre>
<p>In the second example, we started with a fair coin but later switched to a biased coin (<span class="math inline">\(q = 0.6\)</span>) at <span class="math inline">\(n = 200\)</span>. Therefore the change point is <span class="math inline">\(\nu = 200\)</span>.
In this case, the change detection statistic <span class="math inline">\(M_n\)</span> stays below the detection line <span class="math inline">\(y = \log(1/\alpha)\)</span> before the change point <span class="math inline">\(n = 200\)</span> and starts to increase and across the detection line at <span class="math inline">\(n = 288\)</span>. Therefore, we are correctly detecting a change with a detection delay <span class="math inline">\(N^* - \nu = 88\)</span>.</p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>The Lorden’s lemma tells us that repeated sequential tests can be used as a change detection procedure. Therefore, whenever we can do a sequential test, we can do also a change detection procedure, which is useful to monitor a silent change in the underlying distribution.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In many real applications, the pre-change distribution <span class="math inline">\(P\)</span> is often known or can be estimated accurately based on previous sample history under the normal condition. However, the post-change distribution is often unknown. Designing an online change detector that is efficient over a large class of “potential” post-change distributions is still an active research area. See, e.g., <a href="https://arxiv.org/pdf/2203.03532.pdf">arXiv</a> and the reference therein.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Original Lorden’s lemma has a stronger upper bound on WAD but in this post, I simplified it a bit.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/change-detection/">change detection</a>
  
  <a class="badge badge-light" href="/tag/change-point/">change point</a>
  
  <a class="badge badge-light" href="/tag/sequential-test/">sequential test</a>
  
  <a class="badge badge-light" href="/tag/inference/">inference</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/&amp;text=From%20Sequential%20Tests%20to%20Change%20Detections" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/&amp;t=From%20Sequential%20Tests%20to%20Change%20Detections" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=From%20Sequential%20Tests%20to%20Change%20Detections&amp;body=https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://shinjaehyeok.github.io/post/statistics/change_detection/from_seq_test_to_change_detection/&amp;title=From%20Sequential%20Tests%20to%20Change%20Detections" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/author/jaehyeok-shin/avatar_hu4bfebfed29c68355e919404572255097_130697_270x270_fill_q90_lanczos_center.jpg" alt="Jaehyeok Shin">
      

      <div class="media-body">
        <h5 class="card-title"><a href="https://shinjaehyeok.github.io/">Jaehyeok Shin</a></h5>
        <h6 class="card-subtitle">Data Scientist</h6>
        <p class="card-text">Interested in understanding the sequential and adaptive nature of data analysis.</p>
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/Project20s" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=9vx2IdMAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/jh-shin/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  







<section id="comments">
  
    
<div id="disqus_thread"></div>
<script>
  let disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); s.async = true;
    s.src = 'https://' + "shinjaehyeok" + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  
</section>








  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/statistics/sequential_test_for_ratio_of_means/sequential_test_for_ratio_of_means/">Sequential test for ratio of two means</a></li>
      
      <li><a href="/post/statistics/sequential_test_safety/sequential_test_flexibility_safety/">Advantages of Sequential Hypothesis Testing: 2. Flexibility and Safety</a></li>
      
      <li><a href="/post/statistics/sequential_test_efficiency/stcd-tutorial/">Advantages of Sequential Hypothesis Testing: 1. Sample efficiency</a></li>
      
    </ul>
  </div>
  





  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js" integrity="sha512-7t8APmYpzEsZP7CYoA7RfMPV9Bb+PJHa9x2WiUnDXZx3XHveuyWUtvNOexhkierl5flZ3tr92dP1mMS+SGlD+A==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/latex.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    <script id="dsq-count-scr" src="https://shinjaehyeok.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.e286f7f9ceb21a7a7468a7eb9912703f.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    Copyright 2024 Jaehyeok Shin. All rights reserved.
  </p>

  
  








 
  <script>
  $(document).ready(function () {
    window.initializeCodeFolding("show" === "hide");
  });
  </script>
  <script src="/js/codefolding.js"></script>



  <p class="powered-by">
    
    Published with
    <a href="https://wowchemy.com" target="_blank" rel="noopener">Wowchemy Website Builder</a>
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
